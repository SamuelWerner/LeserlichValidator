var jsonDataStructure = {
    "Farben": {
        "titel": "Farben",
        "inhalt": {
            "Rotgruen": {
                "titel": "Rot-Grün-Kombinationen",
                "beschreibung": "Rot-Grün-Kombinationen vermeiden.",
                "ergebnis": ""
            },
            "Unterscheidung": {
                "titel": "Zusätzliches Unterscheidungsmerkmal",
                "beschreibung": "Zusätzlich zur Farbe ein weiteres Unterscheidungsmerkmal verwenden.",
                "ergebnis": ""
            },
            "Sparsam": {
                "titel": "Farben sparsam einsetzen",
                "beschreibung": "Farben sparsam einsetzen und klar voneinander abgrenzen.",
                "ergebnis": ""
            },
            "Komplementaer": {
                "titel": "Komplementärfarben",
                "beschreibung": "Kontraste von Komplementärfarben vermeiden.",
                "ergebnis": ""
            },
            "Semantisch": {
                "titel": "Semantische Farbkonventionen",
                "beschreibung": "Das Beachten einer einheitlichen Verwendung bestimmter Farben.",
                "ergebnis": ""
            }
        }
    },
    "Kontrast": {
        "titel": "Kontrast",
        "inhalt": {
            "Hintergrund": {
                "titel": "Hintergrund",
                "beschreibung": "Der Kontrast zwischen Text und dem darunter liegenden Hintergrund. ",
                "ergebnis": ""
            },
            "Ebenen": {
                "titel": "Ebenen",
                "beschreibung": "Der Kontrast zwischen zwei Ebenen, die aufeinander liegen.",
                "ergebnis": ""
            },
            "Bild": {
                "titel": "Bild",
                "beschreibung": "Der Kontrast innerhalb eines Bildes. Wie stark hebt sich die wichtige Information vom Hintergrund ab? ",
                "ergebnis": ""
            },
            "BildHintergrund": {
                "titel": "Bild Hintergrund",
                "beschreibung": "Den Kontrast von Text auf Bild als Untergrund bewerten. Je unruhiger das Bild desto ungeeigneter als Hintergrund.  ",
                "ergebnis": ""
            }
        }
    },
    "Schrift": {
        "titel": "Schrift",
        "inhalt": {
            "HumanistischeGroteskschriften": {
                "titel": "<small class='text-muted'>Zeichen/Schriftart/</small>Humanistische Groteskschriften",
                "beschreibung": "Humanistische Groteskschriften (auch als dynamische Sans Serif oder serifenlose Renaissance-Antiqua bezeichnet) werden für Leser mit Sehbehinderungen für alle Textarten empfohlen.",
                "ergebnis": ""
            },
            "KlassizistischeGroteskschriften": {
                "titel": "<small class='text-muted'>Zeichen/Schriftart/</small>Klassizistische Groteskschriften",
                "beschreibung": "Klassizistische Groteskschriften wie z. B. Arial oder Helvetica sind aufgrund ihrer geschlosseneren Buchstabenformen weniger geeignet als humanistische Groteskschriften.",
                "ergebnis": ""
            },
            "Serifenschriften": {
                "titel": "<small class='text-muted'>Zeichen/Schriftart/</small>Serifenschriften",
                "beschreibung": "Bei Verwendung von Serifenschriften sind Schriften, die dem dynamischen Formprinzip folgen (Renaissance-Antiqua), zu bevorzugen.",
                "ergebnis": ""
            },
            "KlassizistischeAntiquaschriften": {
                "titel": "<small class='text-muted'>Zeichen/Schriftart/</small>Klassizistische Antiquaschriften ",
                "beschreibung": "Klassizistische Antiquaschriften sind aufgrund ihrer feinen Haarstriche nicht geeignet.Serifen sollen sich nicht berühren.",
                "ergebnis": ""
            },
            "Ligaturen": {
                "titel": "<small class='text-muted'>Zeichen/Schriftart/</small>Ligaturen",
                "beschreibung": "Ligaturen (Verbindung von zwei Buchstaben in einem Zeichen) erschweren in manchen Fällen die Erkennbarkeit einzelner Zeichen und sollen daher mit Bedacht gesetzt werden.",
                "ergebnis": ""
            },
            "SchriftgroessenEmpfehlung": {
                "titel": "<small class='text-muted'>Zeichen/Schriftgröße/</small>DIN 1450",
                "beschreibung": "Die Schriftgrößenempfehlungen der DIN 1450 berücksichtigen unterschiedliche Textarten, den Betrachtungsabstand und die Sehschärfe (Visus) und beziehen sich auf die Mittellänge, die in Millimetern angegeben wird.",
                "ergebnis": ""
            },
            "SchriftgroessenEmpfehlungSehbehinderung": {
                "titel": "<small class='text-muted'>Zeichen/Schriftgröße/</small>Sehbehinderung",
                "beschreibung": "Für Menschen mit Sehbehinderungen wird die Multiplikation der angegebenen Größen mit einem Faktor zwischen 1,4 und 1,75 empfohlen (Visus 0,4 bis 0,5).",
                "ergebnis": ""
            },
            "SchriftgroessenEmpfehlungEndgeraete": {
                "titel": "<small class='text-muted'>Zeichen/Schriftgröße/</small>Verschiedene Endgeräte",
                "beschreibung": "Der Schriftgrößenrechner erleichtert es, die richtige Schriftgröße für den konkreten Anwendungsfall zu ermitteln.",
                "ergebnis": ""
            },
            "SchriftgroessenEmpfehlungHintergrund": {
                "titel": "<small class='text-muted'>Zeichen/Schriftgröße/</small>Heller Text auf dunklem Hintergrund",
                "beschreibung": "Bei hellem Text auf dunklem Hintergrund sollte die Schriftgröße um 10 % erhöht werden.",
                "ergebnis": ""
            },
            "StrichstaerkeRegular": {
                "titel": "<small class='text-muted'>Zeichen/Strichstärke/</small>Strichstärke Regular",
                "beschreibung": "Regular (je nach Font auch Normal, Book, Roman, Text) Feine und fette Schriftstärken vermeiden.",
                "ergebnis": ""
            },
            "Strichstaerkenkontrast": {
                "titel": "<small class='text-muted'>Zeichen/Strichstärke/</small>Strichstärkenkontrast",
                "beschreibung": "Schriften mit hohem Strichstärkenkontrast vermeiden.",
                "ergebnis": ""
            },
            "NormaleSchriftweite": {
                "titel": "<small class='text-muted'>Zeichen/Schriftweite/</small>Normale Schriftweiten",
                "beschreibung": "Normale Schriftweiten (schmale oder breite Schriftweiten vermeiden).",
                "ergebnis": ""
            },
            "Zeichenabstand": {
                "titel": "<small class='text-muted'>Zeichen/Zeichenbezogene Empfehlung/</small>Zeichenabstand",
                "beschreibung": "Der Zeichenabstand mindestens ein drittel der Mittellänge betragen.",
                "ergebnis": ""
            },
            "VoreingestellterZeichenabstand": {
                "titel": "<small class='text-muted'>Zeichen/Zeichenbezogene Empfehlung/</small>Zeichenabstand",
                "beschreibung": "Verringerung der im Schriftfont eingerichteten Zeichenabstände vermeiden. Keine Sperrung von Text (großer Zeichenabstand).",
                "ergebnis": ""
            },
            "SerifenBeruehrung": {
                "titel": "<small class='text-muted'>Zeichen/Zeichenbezogene Empfehlung/</small>Serifen",
                "beschreibung": "Serifen sollen sich nicht berühren.",
                "ergebnis": ""
            },
            "ZeichenabstandHintergrund": {
                "titel": "<small class='text-muted'>Zeichen/Zeichenbezogene Empfehlung/</small>Hintergrund",
                "beschreibung": "Bei hellem Text auf dunklem Hintergrund Zeichenabstand um ca. 2 % erhöhen.",
                "ergebnis": ""
            },
            "SchreibweiseVersalien": {
                "titel": "<small class='text-muted'>Zeichen/Schreibweise/</small>Versalien",
                "beschreibung": "Texte in gemischter Groß- und Kleinschreibung setzen (Keine Versalien).",
                "ergebnis": ""
            },
            "HervorhebungenZwischenueberschriften": {
                "titel": "<small class='text-muted'>Zeichen/Hervorhebung/</small>Zwischenüberschriften",
                "beschreibung": "Hervorhebungen von Zwischenüberschriften und Auszeichnungen durch (halb-)fette und kursive Schriften.",
                "ergebnis": ""
            },
            "HervorhebungZusaetzlicheUnterscheidung": {
                "titel": "<small class='text-muted'>Zeichen/Hervorhebung/</small>Zusätzliches Unterscheidungsmerkmal",
                "beschreibung": "Bei farbigen Texthervorhebungen als zusätzliches Unterscheidungsmerkmal auf ausreichenden Kontrast achten.",
                "ergebnis": ""
            },
            "HervorhebungenSparsam": {
                "titel": "<small class='text-muted'>Zeichen/Hervorhebung/</small>Sparsam",
                "beschreibung": "Hervorhebungen sollten sparsam eingesetzen werden.",
                "ergebnis": ""
            },
            "HervorhebungUnterstreichungLinks": {
                "titel": "<small class='text-muted'>Zeichen/Hervorhebung/</small>Links",
                "beschreibung": "Unterstreichungen nur für Links.",
                "ergebnis": ""
            },
            "ZeilenabstandOberUnterlaenge": {
                "titel": "<small class='text-muted'>Text/Zeilenabstand/</small>Ober- Unterlänge",
                "beschreibung": "Ober- und Unterlängen sollen sich nicht berühren.",
                "ergebnis": ""
            },
            "ZeilenabstandLangeZeilen": {
                "titel": "<small class='text-muted'>Text/Zeilenabstand/</small>Lange Zeilen",
                "beschreibung": "Bei langen Zeilen sollte der Zeilenabstand vergrößert werden.",
                "ergebnis": ""
            },
            "ZeilenlaengeMaximal": {
                "titel": "<small class='text-muted'>Text/Zeilenlänge/</small>Zeilenlänge",
                "beschreibung": "Zeilenlänge bei Lesetext maximal 80 Zeichen je Zeile.",
                "ergebnis": ""
            },
            "TextanordnungWaagrecht": {
                "titel": "<small class='text-muted'>Text/Textanordnung/</small>Waagrecht",
                "beschreibung": "Text waagerecht anordnen.",
                "ergebnis": ""
            },
            "TextanordnungLinks": {
                "titel": "<small class='text-muted'>Text/Textanordnung/</small>Ausrichtung",
                "beschreibung": "Linksbündiger Flattersatz ist Blocksatz vorzuziehen. Von mittelaxialem oder rechtsbündigem Satz ist abzusehen.",
                "ergebnis": ""
            },
            "AbstaendeRand": {
                "titel": "<small class='text-muted'>Text/Ränder und Abstände/</small>Seitenrand",
                "beschreibung": "Deutliche Abstände zwischen Text und Seitenrand einhalten.",
                "ergebnis": ""
            },
            "AbstaendeBilder": {
                "titel": "<small class='text-muted'>Text/Ränder und Abstände/</small>Bilder",
                "beschreibung": "Abstand zwischen Text und Bildern und zwischen Textspalten mindestens 6 mm.",
                "ergebnis": ""
            },
            "AbstaendeFlattersatz": {
                "titel": "<small class='text-muted'>Text/Ränder und Abstände/</small>Flattersatz",
                "beschreibung": "Bei Textspalten in linksbündigem Flattersatz Trennlinien zwischen den Spalten einfügen.",
                "ergebnis": ""
            },
            "Linienstaerke": {
                "titel": "<small class='text-muted'>Text/Ränder und Abstände/</small>Linienstärke",
                "beschreibung": "Linienstärke von Tabellen und Trennlinien sollen mindestens 1 Pica-Punkt bzw. 2 Pixel.",
                "ergebnis": ""
            }
        }
    }
}

//
$( document ).ready(function() {
    jsonDataStructure['Schrift']['inhalt']['HumanistischeGroteskschriften']['ergebnis']= validateSchriftZeichenSchriftartGrotesk();
    console.log("1");
    jsonDataStructure['Schrift']['inhalt']['KlassizistischeGroteskschriften']['ergebnis']=validateSchriftZeichenSchriftartKlassGrotesk();
    console.log("2");
    jsonDataStructure['Schrift']['inhalt']['Serifenschriften']['ergebnis']=validateSchriftZeichenSchriftartSerifen();
    console.log("3");
    jsonDataStructure['Schrift']['inhalt']['Ligaturen']['ergebnis']=validateSchriftZeichenSchriftartLigaturen();
    console.log("4");
    jsonDataStructure ['Kontrast']['inhalt']['Hintergrund']['ergebnis']=validateKontrasteHintergrund();
    console.log("5");
    jsonDataStructure ['Kontrast']['inhalt']['Ebenen']['ergebnis'] =validateKontrasteEbenen();
    console.log("6");

    var url = window.location.protocol + "//" + window.location.host + "/checkResult"

    $.ajax({
        url: url,
        type: 'post',
        contentType: 'application/json',
        data: JSON.stringify(jsonDataStructure)
    })
});


// ####################################################################################################################
// ################## Konstrast Ebenen ############################################################################
// ####################################################################################################################

function validateKontrasteEbenen(){
    result = "";
    var bool = false;

    var relLuBackgroundArray = new Array();
    var relLuColorArray = new Array();

    var backgroundColorArray = new Array();
    var textColorArray = new Array();

    var contrastArray = new Array();

    for(var node of window.document.querySelectorAll('*')) {
        for (let pseudo of ['', ':befor', ':after']) {


            let backgroundColor = window.getComputedStyle(node, pseudo).backgroundColor;
            let color = window.getComputedStyle(node, pseudo).color;

            if (backgroundColor.length != "") {
                backgroundColor = backgroundColor.substr(4);
                backgroundColor = backgroundColor.slice(0, -1);
                var backgroundSplit = backgroundColor.split(",");

                var bgValueR = parseInt(backgroundSplit[0]);
                var bgValueG = parseInt(backgroundSplit[1]);
                var bgValueB = parseInt(backgroundSplit[2]);

                var relLumiBackgroundC = RelativeLuminance(bgValueR, bgValueG, bgValueB);

                relLuBackgroundArray.push(relLumiBackgroundC);
                backgroundColorArray.push(backgroundColor);

            }
            if (color.length != ""){
                color = color.substr(4);
                color = color.slice(0, -1);
                var colorSplit = color.split(",");

                var cValueR = parseInt(colorSplit[0]);
                var cValueG = parseInt(colorSplit[1]);
                var cValueB = parseInt(colorSplit[2]);

                var relLumiTextColor = RelativeLuminance(cValueR, cValueG, cValueB);

                relLuColorArray.push(relLumiTextColor);
                textColorArray.push(color);
            }

            //  var tags = node.textContent;
            // var parentTags = node.parentNode.textContent;

            //result +=  node + " -> " + "Hintergrund: " + backgroundColor + "</br>" + node + "Textfarbe: " + color + "</br>" + "Kontrast: "+ contrast + "</br>" + "</br>";
            break;

        }
    }

    for ( let i = 0; i < relLuBackgroundArray.length; i++){
        for (let j = 0; j < relLuBackgroundArray.length; j++) {

            var contrast = contrastRelation(relLuBackgroundArray[i], relLuBackgroundArray[j]);
            if (isNaN(contrast))
                continue;
            if (contrastArray.includes(contrast))
                continue;
            contrastArray.push(contrast);


            result +=  "Hintergrund Nr. 1: " + backgroundColorArray[i] + "</br>" + "Hintergrund Nr. 2: " + backgroundColorArray[j] + "</br>" + "Kontrastverhältnis: " + contrast.toFixed(1) + " : 1" + "</br>" + "</br>";

        }

    }


    if (result == ""){
        return "<div class='alert alert-success'>Keine Werte zum validieren vorhanden.</div>"
    } else {
        return "<div class='alert alert-warning'>Folgende Farben wurden validiert</b>: </br>" + result + "</div>";
    }
}



function RelativeLuminance(r,g,b){
    var rNormalisiert = r/255; // 255 is the top color value equal to 1 for der lightest color value
    var gNormalisiert = g/255;
    var bNormalisiert = b/255;

    if (rNormalisiert <= 0.03928){
        var rNext = rNormalisiert/12.92;
    }
    else
        var rNext = Math.pow(((rNormalisiert+0.055)/1.055),2.4);

    if (gNormalisiert <= 0.03928){
        var gNext = gNormalisiert/12.92;
    }
    else gNext = Math.pow(((gNormalisiert+0.055)/1.055),2.4);

    if (bNormalisiert <= 0.03928){
        var bNext = bNormalisiert/12.92;
    }
    else bNext = Math.pow(((bNormalisiert+0.055)/1.055),2.4);

    var relativeLuminance = 0.2126 * rNext + 0.7152 * gNext + 0.0722 * bNext;

    return relativeLuminance;
}


function contrastRelation(background, color){
    var y1;
    var y2;

    if (background < color){
        y1 = color ;
        y2 = background;
    }
    else {
        y1 = background;
        y2 = color;
    }

    var contrastRelation = (y1 + 0.05)/(y2 + 0.05);

    return contrastRelation;

}
// ####################################################################################################################
// ################## Konstrast Hintergrund ############################################################################
// ####################################################################################################################

function validateKontrasteHintergrund(){
    result = "";
    var bool = false;

    var relLuBackgroundArray = new Array();
    var relLuColorArray = new Array();

    var backgroundColorArray = new Array();
    var textColorArray = new Array();

    var contrastArray = new Array();

    for(var node of window.document.querySelectorAll('*')) {
        for (let pseudo of ['', ':befor', ':after']) {


            let backgroundColor = window.getComputedStyle(node, pseudo).backgroundColor;
            let color = window.getComputedStyle(node, pseudo).color;

            if (backgroundColor.length != "") {
                backgroundColor = backgroundColor.substr(4);
                backgroundColor = backgroundColor.slice(0, -1);
                var backgroundSplit = backgroundColor.split(",");

                var bgValueR = parseInt(backgroundSplit[0]);
                var bgValueG = parseInt(backgroundSplit[1]);
                var bgValueB = parseInt(backgroundSplit[2]);

                var relLumiBackgroundC = RelativeLuminance(bgValueR, bgValueG, bgValueB);

                relLuBackgroundArray.push(relLumiBackgroundC);
                backgroundColorArray.push(backgroundColor);

            }
            if (color.length != ""){
                color = color.substr(4);
                color = color.slice(0, -1);
                var colorSplit = color.split(",");

                var cValueR = parseInt(colorSplit[0]);
                var cValueG = parseInt(colorSplit[1]);
                var cValueB = parseInt(colorSplit[2]);

                var relLumiTextColor = RelativeLuminance(cValueR, cValueG, cValueB);

                relLuColorArray.push(relLumiTextColor);
                textColorArray.push(color);
            }

            //  var tags = node.textContent;
            // var parentTags = node.parentNode.textContent;

            //result +=  node + " -> " + "Hintergrund: " + backgroundColor + "</br>" + node + "Textfarbe: " + color + "</br>" + "Kontrast: "+ contrast + "</br>" + "</br>";
            break;
        }
    }

    for ( let i = 0; i < relLuBackgroundArray.length; i++){
        for (let j = 0; j < relLuColorArray.length; j++) {

            var contrast = contrastRelation(relLuBackgroundArray[i], relLuColorArray[j]);
            if (isNaN(contrast))
                continue;
            if (contrastArray.includes(contrast))
                continue;
            contrastArray.push(contrast);


            result +=  "Hintergrund: " + backgroundColorArray[i] + "</br>" + "Textfarbe: " + textColorArray[j] + "</br>" + "Kontrastverhältnis: " + contrast.toFixed(1) + " : 1" + "</br>" + "</br>";

        }

    }
    if (result == ""){
        return "<div class='alert alert-success'>Keine Werte zum validieren vorhanden.</div>"
    } else {
        return "<div class='alert alert-warning'>Folgende Farben wurden validiert</b>: </br>" + result + "</div>";
    }
}



function RelativeLuminance(r,g,b){
    var rNormalisiert = r/255; // 255 is the top color value equal to 1 for der lightest color value
    var gNormalisiert = g/255;
    var bNormalisiert = b/255;

    if (rNormalisiert <= 0.03928){
        var rNext = rNormalisiert/12.92;
    }
    else
        var rNext = Math.pow(((rNormalisiert+0.055)/1.055),2.4);

    if (gNormalisiert <= 0.03928){
        var gNext = gNormalisiert/12.92;
    }
    else gNext = Math.pow(((gNormalisiert+0.055)/1.055),2.4);

    if (bNormalisiert <= 0.03928){
        var bNext = bNormalisiert/12.92;
    }
    else bNext = Math.pow(((bNormalisiert+0.055)/1.055),2.4);

    var relativeLuminance = 0.2126 * rNext + 0.7152 * gNext + 0.0722 * bNext;

    return relativeLuminance;
}


function contrastRelation(background, color){
    var y1;
    var y2;

    if (background < color){
        y1 = color ;
        y2 = background;
    }
    else {
        y1 = background;
        y2 = color;
    }

    var contrastRelation = (y1 + 0.05)/(y2 + 0.05);

    return contrastRelation;

}
// ####################################################################################################################
// ################### Zeichen Schriftart Ligaturen ###################################################################
// ####################################################################################################################

function validateSchriftZeichenSchriftartLigaturen() {
    result = "";
    var i = 0;
    for (let node of window.document.querySelectorAll('*')) {
        if (!node.textContent) continue;
        let text = node.textContent;
        if (text.includes("Æ") || text.includes("æ") || text.includes("Œ") || text.includes("œ") || text.includes("Ĳ") || text.includes("ĳ")){
            node.classList.add("validationMarker"+i);
            result += "Zeile " + lineOfCode(window.document.documentElement.innerHTML, "validationMarker"+i) + ": " +text+"</br>";
            i++;
            break;
        }
    }
    if (result === ""){
        return "<div class='alert alert-success'>Validation erfolgreich.</div>"
    } else {
        return "<div class='alert alert-warning'>Es wurden Ligaturen erkannt.</b>: </br>" + result + "</div>";
    }
}

function validateSchriftZeichenSchriftartSerifen () {
    result = "";
    var i = 0;
    for (let node of window.document.querySelectorAll('*')) {
        if (!node.textContent) continue;
        if (!node.style) continue;

        for (let pseudo of ['', ':before', ':after']) {
            let fontFamily = window.getComputedStyle(node, pseudo).fontFamily +"";
            if (fontFamily && fontFamily !== ""){
                if (fontFamily.includes("serif") && !fontFamily.includes("-serif")){
                    node.classList.add("validationMarker"+i);
                    result += "Zeile " + lineOfCode(window.document.documentElement.innerHTML, "validationMarker"+i) + ": " +fontFamily+"</br>";
                    i++;
                    break;
                }
            }
        }
    }
    if (result === ""){
        return "<div class='alert alert-success'>Validation erfolgreich.</div>"
    } else {
        return "<div class='alert alert-warning'>Es wurden Schriften mit Serifen erkannt. Falls die Serifen beibehalten werden sollen, kann als Alternative Renaissance-Antiqua verwendet werden:</b>: </br>" + result + "</div>";
    }
}

// ####################################################################################################################
// ################### Zeichen Schriftart KlasGrotesk ##################################################################
// ####################################################################################################################

function validateSchriftZeichenSchriftartKlassGrotesk () {
    result = "";
    var i = 0;
    for (let node of window.document.querySelectorAll('*')) {
        if (!node.textContent) continue;
        if (!node.style) continue;

        for (let pseudo of ['', ':before', ':after']) {
            let fontFamily = window.getComputedStyle(node, pseudo).fontFamily +"";
            if (fontFamily && fontFamily !== ""){
                if (fontFamily.includes("Helvetica") || fontFamily.includes("Arial")){
                    node.classList.add("validationMarker"+i);
                    result += "Zeile " + lineOfCode(window.document.documentElement.innerHTML, "validationMarker"+i) + ": " +fontFamily+"</br>";
                    i++;
                    break;
                }
            }
        }
    }
    if (result === ""){
        return "<div class='alert alert-success'>Validation erfolgreich.</div>"
    } else {
        return "<div class='alert alert-warning'>Es wurden Klassizistische Groteskschriften Schriften erkannt. Evtl prüfen und durch Humanistische Groteskschriften ersetzen:</b>: </br>" + result + "</div>";
    }
}

// ####################################################################################################################
// ################### Zeichen Schriftart Grotesk ####################################################################
// ####################################################################################################################

function validateSchriftZeichenSchriftartGrotesk() {
    result = "";
    var i = 0;
    for (let node of window.document.querySelectorAll('*')) {
        if (!node.textContent) continue
        if (!node.style) continue

        for (let pseudo of ['', ':before', ':after']) {
            let fontFamily = window.getComputedStyle(node, pseudo).fontFamily +"";
            // let bg = window.getComputedStyle(node, pseudo).backgroundColor +"";
            // if (bg !== '') console.log(bg)
            if (fontFamily && fontFamily !== ""){
                if (!fontFamily.includes("sans-serif") && !fontFamily.includes("inherit") && !fontFamily.includes("-webkit-small-control") && !fontFamily.includes("monospace")){
                    node.classList.add("validationMarker"+i);
                    result += "Zeile " + lineOfCode(window.document.documentElement.innerHTML, "validationMarker"+i)+", "+ node.nodeName + ": " +fontFamily+"</br>";
                    i++;
                    break;
                }
            }
        }
    }
    if (result == ""){
        return "<div class='alert alert-success'>Validation erfolgreich.</div>"
    } else {
        return "<div class='alert alert-warning'>Es wurden abweichende Schriften erkannt. Evtl prüfen:</b>: </br>" + result + "</div>";
    }
}

// ####################################################################################################################
// ################### Hilfsfunktionen ################################################################################
// ####################################################################################################################

function lineOfCode(text, substring){
    var line = 0, matchedChars = 0;

    for (var i = 0; i < text.length; i++) {
        text[i] === substring[matchedChars] ? matchedChars++ : matchedChars = 0;

        if (text[i] === '\n'){
            line++;
        }

        if (matchedChars === substring.length){
            return line;
        }
    }

    return  -1;
}
